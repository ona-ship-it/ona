<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800" viewBox="0 0 1200 800" font-family="Segoe UI, Arial, sans-serif">
  <style>
    .box { fill:#f7f9fc; stroke:#4a5568; stroke-width:2; rx:8; }
    .title { font-size:18px; font-weight:bold; fill:#1a202c; }
    .text { font-size:14px; fill:#2d3748; }
    .arrow { stroke:#2b6cb0; stroke-width:2; marker-end:url(#arrowhead); }
    .caption { font-size:12px; fill:#2b6cb0; }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2b6cb0" />
    </marker>
  </defs>

  <!-- Left: Users/Admins -->
  <rect class="box" x="40" y="60" width="300" height="180" />
  <text class="title" x="60" y="90">Users (Browser)</text>
  <text class="text" x="60" y="120">• Browse active giveaways</text>
  <text class="text" x="60" y="145">• Join giveaways (tickets)</text>
  <text class="text" x="60" y="170">• Wallet: balance, deposit, withdraw</text>

  <rect class="box" x="40" y="280" width="300" height="160" />
  <text class="title" x="60" y="310">Admins (Browser)</text>
  <text class="text" x="60" y="340">• Publish / Unpublish giveaways</text>
  <text class="text" x="60" y="365">• Review pending/reported items</text>
  <text class="text" x="60" y="390">• Actions audited</text>

  <!-- Middle: Next.js API & Auth -->
  <rect class="box" x="400" y="60" width="340" height="220" />
  <text class="title" x="420" y="90">Next.js API</text>
  <text class="text" x="420" y="120">Public: GET /api/giveaways</text>
  <text class="text" x="420" y="145">User Wallet: /api/wallet/*</text>
  <text class="text" x="420" y="170">Admin: POST /api/admin/giveaways/status</text>
  <text class="text" x="420" y="195">Validation: Zod (UUID, status enums)</text>

  <rect class="box" x="400" y="310" width="340" height="130" />
  <text class="title" x="420" y="340">Supabase Auth</text>
  <text class="text" x="420" y="370">• Issues tokens (JWT)</text>
  <text class="text" x="420" y="395">• `auth.uid()` used in DB policies</text>

  <!-- Right: Postgres + RLS -->
  <rect class="box" x="780" y="40" width="360" height="700" />
  <text class="title" x="800" y="70">Postgres + RLS</text>

  <text class="text" x="800" y="100">• Enforces who can read/write rows</text>
  <text class="text" x="800" y="125">• Admins have broader privileges</text>

  <!-- Tables list -->
  <text class="title" x="800" y="160">Tables</text>
  <text class="text" x="800" y="185">giveaways (id, status: draft/active/paused)</text>
  <text class="text" x="800" y="210">tickets (user_id, giveaway_id)</text>
  <text class="text" x="800" y="235">giveaway_contributions (donor_id, amount)</text>
  <text class="text" x="800" y="260">user_wallets (user_id, balance)</text>
  <text class="text" x="800" y="285">deposit_transactions (amount, status)</text>
  <text class="text" x="800" y="310">withdrawal_requests (amount, status)</text>
  <text class="text" x="800" y="335">roles / user_roles (admin membership)</text>
  <text class="text" x="800" y="360">onagui_profiles (is_admin flag)</text>
  <text class="text" x="800" y="385">giveaway_audit (action, actor_id, note)</text>

  <!-- Arrows from Users/Admins to API -->
  <line class="arrow" x1="340" y1="135" x2="400" y2="135" />
  <text class="caption" x="350" y="120">Requests</text>
  <line class="arrow" x1="340" y1="360" x2="400" y2="360" />
  <text class="caption" x="350" y="345">Requests</text>

  <!-- Arrows API -> Auth -> DB -->
  <line class="arrow" x1="570" y1="200" x2="570" y2="310" />
  <text class="caption" x="580" y="255">Token check</text>
  <line class="arrow" x1="740" y1="360" x2="780" y2="360" />
  <text class="caption" x="750" y="345">RLS + Queries</text>

  <!-- Admin action path -->
  <line class="arrow" x1="240" y1="360" x2="400" y2="200" />
  <text class="caption" x="250" y="325">Admin status update</text>
  <line class="arrow" x1="740" y1="200" x2="780" y2="200" />
  <text class="caption" x="750" y="185">Update giveaways</text>
  <line class="arrow" x1="740" y1="220" x2="780" y2="385" />
  <text class="caption" x="745" y="300">Write audit</text>

  <!-- Legend -->
  <rect class="box" x="40" y="480" width="700" height="140" />
  <text class="title" x="60" y="510">Legend</text>
  <text class="text" x="60" y="540">RLS (Row Level Security) ensures each user only sees/changes their own data; admins get wider access based on roles.</text>
  <text class="text" x="60" y="565">Validation ensures requests are well-formed (UUIDs, status values). Audit logs track admin changes for transparency.</text>

  <text class="caption" x="40" y="760">Diagram: Browser → Next.js API → Supabase Auth → Postgres (RLS) → Tables</text>
</svg>